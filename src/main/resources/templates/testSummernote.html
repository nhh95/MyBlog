<!-- post-form.html (Thymeleaf 템플릿) -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>게시글 작성</title>
    <!-- Summernote CSS -->
    <link th:href="@{/css/summernote/summernote-lite.css}" rel="stylesheet" />
    <!-- (필요 시) Summernote 한글화를 위한 언어 파일 -->
    <script th:src="@{/js/summernote/lang/summernote-ko-KR.js}" defer></script>
    <!-- jQuery 먼저 로드 -->
    <link rel="stylesheet" th:href="@{/webjars/jquery-ui/1.14.1/jquery-ui.min.css}">
    <script th:src="@{/webjars/jquery/3.7.1/jquery.min.js}"></script>
    <script th:src="@{/webjars/jquery-ui/1.14.1/jquery-ui.min.js}"></script>

    <!-- Summernote JS (Lite 버전) -->
    <script th:src="@{/js/summernote/summernote-lite.js}" defer></script>
</head>



<body>
<h1>게시글 작성/수정</h1>

<form method="post" >
    <!-- 제목 입력 -->
    <div>
        <label for="title">제목:</label>
        <input type="text" id="title" required/>
    </div>
    <!-- 본문 입력: Summernote 에디터 적용 -->
    <div>

        <textarea id="summernote" ></textarea>
    </div>
    <button type="submit">저장</button>
</form>

<!-- Summernote 에디터 초기화 스크립트 -->
<script th:inline="javascript">
    /*<![CDATA[*/
        $(document).ready(function() {
            $('#summernote').summernote({
                height: 300,
                lang: 'ko-KR',  // 한글 UI (summernote-ko-KR.js 로드된 경우)
                toolbar: [
                  // 최소한의 툴바 설정 (필요에 따라 추가 가능)
                  ['style', ['bold', 'italic', 'underline', 'clear']],
                  ['para', ['ul', 'ol', 'paragraph']],
                  ['insert', ['picture', 'link']],  // 이미지, 링크 삽입 등
                  ['view', ['codeview', 'fullscreen']]
                ],
                callbacks: {
                    onImageUpload: function(files) {
                        // 다중 이미지 업로드 처리
                        for (let i = 0; i < files.length; i++) {
                            uploadImage(files[i]);
                        }
                    }
                }
            });
            // 이미지 업로드를 처리하는 함수 – AJAX로 서버에 파일 전송
            function uploadImage(file) {
                let formData = new FormData();
                formData.append("file", file);
                $.ajax({
                    url: /*[[@{/uploadImage}]]*/,  // 이미지 업로드 서버 엔드포인트
                    type: 'POST',
                    processData: false,
                    contentType: false,
                    data: formData,
                    success: function(imageUrl) {
                        // 성공 시 에디터에 이미지 삽입
                        $('#summernote').summernote('insertImage', imageUrl);
                    },
                    error: function(xhr, status, error) {
                        alert("이미지 업로드 실패: " + status);
                    }
                });
            }
        });
    /*]]>*/
</script>
</body>
</html>